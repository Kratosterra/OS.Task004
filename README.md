# Отчёт. Домашнее задание 4. Вариант 35

## _Шарапов Егор Сергеевич, БПИ219_

> Рекомендую открыть всю папку как проект в **VScode** или **Atom** и удобно и быстро прыгать по ссылкам на файлы из отчета.

## Комментарии к решению

Ответ, который вы видете в папках **./X points/resaults** на следующей конфигурации:

```
> OS: Ubuntu 22.04
> Processor: Intel I7 10750H
> RAM: 16 GB DDR4 3200
```

Для работы с файлами использовались только функции **fprintf, fscanf, fopen**.

> Завершение программ происходит по выполнению поставленной задачи или по сигналу **SIGINT** CTRL+C с полноценным завершением и чисткой.

Результаты работы программы вы можете посмотреть в паках **resaults** для каждого балла.

## Условие
>
> Задача для агронома. Председатель дачного кооператива Сидоров В.И. получил указание, что в связи с составлением единого земельного кадастра, необходимо представить справку о площади занимаемых земель. Известно, что территория с запада и востока параллельна меридианам, на севере ограничены параллелью, а с юга выходят к реке, описываемой функцией f(x). Требуется создать приложение, вычисляющее площадь угодий методом адаптивной квадратуры. Замечание: кривизну Земли из-за малой занимаемой площади не учитывать. Количество процессов, участвующих в вычислениях определяется опционально. Агроном нанимает счетоводов, каждый из которых обсчитывает небольшой участок после чего добавляет свой результат к общей площади полученной в ходе проводимых расчетов. Аграном и каждый счетовод должны быть представлены отдельными процессами, связанными UDP.

## Подход к решению

Мы используем метод адаптивной квардитуры, разделяя задачи между счетоводами, которые оказываются связаны с Агрономом.
Функция f(x) (представление реки) для тестирования будет задаваться как x * x / 1000 и может быть изменена в любой момент.
A и B - координата медиан по широте, будет задаваться в тестирующих файлах.
Каждый из клиентов-счетоводов получает ответственный район и, чтобы оптимизировать колличество обменов, сам контролирует считаемый участок площади. Счетовод завершает свою работу, когда сам понимает, что закончил с выделеными участатками в районе, что позволяет честно разделить работу между клиентами, давая возможность не тратить драгоценное время исполения на закидывание нового участка счетоводу.

## Функции решения
>
> Путь к функции: [./functions/functions.c](./functions/function.c)

## Тесты
>
> Путь к тестам: [./tests](./tests/)

_В работе выполнены требования на 8._

## Содержание

- [Начало](#отчёт-домашнее-задание-4-вариант-35)
- [Выполнено на 4-5](#4-5-балла)
- [Выполнено на 6-7](#6-7-баллов)
- [Выполнено на 8](#8-баллов)
- [Завершение](#конец-отчета)

## 4-5 балла

**Путь:**
[./4-5 points](./4-5%20points/)

**Описание**
Главный **server** проверяет аргументы командной строки и принимает к себе заданное кол-во клиентов, которые получают только свои границы вычисления.

- **Сервер (Агроном)** - получает данные из файла ввода и помогает использовать их клиентам, после завершения всех клиентов записывает в файл вывода конечный ответ.
- **Клиент (Счетовод)** - получает данные от сервера в виде границ и отправляет посчитаную площадь серверу.

Завершение можно производить как звершением вычисления так и SIGINT.
Сервер является агрономом, который знает только свою задачу и то, сколько счетоводов должны сегодня работать.
Счетоводы - это клиенты, которые должны обратиться к агроному и получить свою область работы, а затем передать результат агроному.

**Тесты**

Как запускать тестирование?

```
// Запускаем сервер
./server <ip адрес> <порт> <кол-во клиентов> ../tests/inX.txt resaults/outX.txt
```

```
// Запускаем клиента в разных терминалах <кол-во клиентов> раз
./client <ip адрес> <порт>
```

А где результаты?

> Результаты 5 тестов: [resaults](./4-5%20points/resaults/)

## 6-7 баллов

**Путь:**
[./6-7 points](./6-7%20points/)

**Описание**
Главный **server** проверяет аргументы командной строки и принимает к себе заданное кол-во клиентов, которые получают только свои границы вычисления.
**observer** следит за данными из сервера.

- **Сервер (Агроном)** - получает данные из файла ввода и помогает использовать их клиентам, после завершения всех клиентов записывает в файл вывода конечный ответ.
- **Клиент (Счетовод)** - получает данные от сервера в виде границ и отправляет посчитаную площадь серверу.
- **Клиент-наблюдатель (Наблюдатель)** - получает данные от сервера в виде начальных гранц, кол-ва клиентов, общей площади после каждого возвращения полученной от клиента площади и саму площадь, посчитанную клиентом.

Завершение можно производить как звершением вычисления так и SIGINT.
Сервер является агрономом, который знает только свою задачу и то, сколько счетоводов должны сегодня работать.
Счетоводы - это клиенты, которые должны обратиться к агроному и получить свою область работы, а затем передать результат агроному.
Наблюдатель - это **один** клиент, который получает все данные из сервера. Реагирует на любые изменения, полученные сервером.

Была изменена архитектура сервера, чтобы отправлять данные наблюдателю отдельно, получая подключение перед началом работы с остальными клиентами.

**Тесты**

Как запускать тестирование?

```
// Запускаем сервер
./server <ip адрес> <порт> <кол-во клиентов> ../tests/inX.txt resaults/outX.txt
```

```
// Запускаем наблюдателя сразу после запуска сервера
./observer <ip адрес> <порт>
```

```
// Запускаем клиента в разных терминалах <кол-во клиентов> раз
./client <ip адрес> <порт>
```

А где результаты?

> Результаты 5 тестов: [resaults](./6-7%20points/resaults/)

## 8 баллов

**Путь:**
[./8_points](./8%20points/)

**Описание**
Главный **server** проверяет аргументы командной строки и принимает к себе заданное кол-во клиентов, которые получают только свои границы вычисления.
**observer** следят за данными из сервера.

- **Сервер (Агроном)** - получает данные из файла ввода и помогает использовать их клиентам, после завершения всех клиентов записывает в файл вывода конечный ответ.
- **Клиент (Счетовод)** - получает данные от сервера в виде границ и отправляет посчитаную площадь серверу.
- **Клиент-наблюдатель (Наблюдатель)** - получает данные о общей площади от сервера после каждого возвращения полученной от клиента площади и саму площадь, посчитанную клиентом.

Завершение можно производить как звершением вычисления так и SIGINT.
Сервер является агрономом, который знает только свою задачу и то, сколько счетоводов должны сегодня работать.
Счетоводы - это клиенты, которые должны обратиться к агроному и получить свою область работы, а затем передать результат обратно агроному.
Наблюдатели - это клиенты **(ограничение 5 активных клиентов, если завершить один из клиентов, нового можно будет добавить)**, который получает все данные из сервера. Реагирует на любые изменения, полученные сервером. Наблюдатели могут быть подключены в любой момент работы сервера.

Для работы с клиентами-наблюдателями используется стабильный массив размера MAX_OBSERVERS с адресами сокетов, который заполняется по мере добавления клиентов-наблюдателей. При отключении одного из клиентов-наблюдателей, есть возможность добавить еще одного клиента наблюдателя на освободившееся место. Всем рабочим сокетам каждое обновление данных отправляется напрямую. Если массив сокетов заполнен, то сервер выведет сообщение об этом.

Клиенты-наблюдатели могут быть добавлены в любой момент.

**Тесты**

Как запускать тестирование?

```
// Запускаем сервер
./server <ip адрес> <порт> <кол-во клиентов> ../tests/inX.txt resaults/outX.txt
```

```
// Запускаем наблюдателя когда угодно, можно завершать и снова добавлять.
./observer <ip адрес> <порт>
```

```
// Запускаем клиента в разных терминалах <кол-во клиентов> раз
./client <ip адрес> <порт>
```

А где результаты?

> Результаты 5 тестов: [resaults](./8%20points/resaults/)

# Конец отчета
